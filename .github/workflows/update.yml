name: Update README
on:
  issues: {}
jobs:
  update_readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: 12.x
      - name: Update README file
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
        run: |
          node << 'EOF'
            const fs = require('fs')
            const { execSync } = require('child_process')
            const query = `query QueryIssues { 
              repository(owner: "dtinth", name: "github-actions-snippets") {
                issues(first: 100, labels: ["snippet"]) {
                  nodes {
                    title
                    author {
                      login
                    }
                    body
                    number
                    url
                    reactionGroups {
                      content
                      users {
                        totalCount
                      }
                    }
                  }
                }
              }
            }`
            const input = JSON.stringify({ query })
            const issues = JSON.parse(String(execSync(`curl -H "Authorization: Bearer ${process.env.GITHUB_TOKEN}" -X POST -d @-`, { input })))
            console.log(issues)
          EOF
